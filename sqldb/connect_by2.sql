-- 계층형 조회 
CREATE TABLE EMP(
    EMPNO NUMBER(10) PRIMARY KEY,
    ENAME VARCHAR2(20),
    DEPTNO NUMBER(10),
    MGR NUMBER(10),
    JOB VARCHAR2(20),
    SAL NUMBER(10)
);

INSERT INTO EMP VALUES (1000, 'TEST1', 20, NULL, 'CLERK', 800);
INSERT INTO EMP VALUES (1001, 'TEST2', 30, 1000, 'SALESMAN', 1600);
INSERT INTO EMP VALUES (1002, 'TEST3', 30, 1000, 'SALESMAN', 1250);
INSERT INTO EMP VALUES (1003, 'TEST4', 20, 1000, 'MANAGER', 2975);
INSERT INTO EMP VALUES (1004, 'TEST5', 30, 1000, 'SALESMAN', 1250);
INSERT INTO EMP VALUES (1005, 'TEST6', 30, 1001, 'MANAGER', 2850);
INSERT INTO EMP VALUES (1006, 'TEST7', 10, 1001, 'MANAGER', 2450);
INSERT INTO EMP VALUES (1007, 'TEST8', 20, 1006, 'ANALYST', 3000);
INSERT INTO EMP VALUES (1008, 'TEST9', 30, 1006, 'PRESIDENT', 5000);
INSERT INTO EMP VALUES (1009, 'TEST10', 30, 1002, 'SALESMAN', 1500);
INSERT INTO EMP VALUES (1010, 'TEST11', 20, 1002, 'CLERK', 1100);
INSERT INTO EMP VALUES (1011, 'TEST11', 30, 1001, 'CLERK', 950);
INSERT INTO EMP VALUES (1012, 'TEST13', 20, 1000, 'ANALYST', 3000);
INSERT INTO EMP VALUES (1013, 'TEST14', 10, 1000, 'CLERK', 1300);

COMMIT;

SELECT * FROM EMP;

-- LEVEL : 검색 항목의 깊이를 의미하고 가장 상위 레벨이 1이다.
SELECT LEVEL 
FROM DUAL
CONNECT BY LEVEL <=10; --LEVEL를 쓰면 CONNECT BY를 써야 함

-- 레벨 검색하기
-- EMPNO 1000번이 가장 상위
-- EMPNO 1000, 1001, 1002, 1003, 1004번의 관리자는 1000이다.


SELECT * FROM EMP;

SELECT LEVEL, EMPNO, MGR  --MGR상위
FROM EMP
START WITH MGR IS NULL
CONNECT BY PRIOR EMPNO = MGR;  -- 조인조건

/*
1000 NULL
1001 1000
1005 1001
1006 1001
1007 1006

*/



SELECT LEVEL, EMPNO, MGR  --MGR상위
FROM EMP
START WITH MGR = 1001
CONNECT BY PRIOR  MGR = EMPNO ;  -- 조인조건






-- 최대 계층 수 구하기
SELECT MAX(LEVEL)
FROM EMP
START WITH MGR IS NULL
CONNECT BY PRIOR EMPNO = MGR;















